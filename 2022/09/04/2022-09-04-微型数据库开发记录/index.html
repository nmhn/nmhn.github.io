<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><title>微型数据库开发记录 | Hexo</title><link rel="apple-touch-icon" sizes="57x57" href="/images/webclip/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="72x72" href="/images/webclip/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/images/webclip/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/images/webclip/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/images/webclip/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/images/webclip/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/images/webclip/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/webclip/apple-touch-icon-180x180.png"><link rel="apple-touch-icon" sizes="167x167" href="/images/webclip/apple-touch-icon-167x167.png"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml"></head><body><main class="main"><header class="header"><div class="container"><nav class="navbar d-flex align-items-center"><a class="brand" href="/"><img class="logo lazyload" data-src="/images/brand.svg" alt="Hexo" role="img"></a><ul class="main-nav"><li class="nav-item"><a class="nav-item-link" href="/">首页</a></li><li class="nav-item"><a class="nav-item-link" href="/gallery">画廊</a></li><li class="nav-item"><a class="nav-item-link" href="/stories">案例</a></li><li class="nav-item"><a class="nav-item-link" href="/archives">新闻</a></li><li class="nav-item"><a class="nav-item-link" href="/about">关于</a></li></ul></nav><a id="mobile-nav-toggle"><span class="mobile-nav-toggle-bar"></span> <span class="mobile-nav-toggle-bar"></span> <span class="mobile-nav-toggle-bar"></span></a></div></header><section><div class="container"><article id="post-2022-09-04-微型数据库开发记录" class="article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting"><div class="artcle-cover mb-5"></div><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">微型数据库开发记录</h1><div class="article-meta"><time class="text-gray" datetime="2022-09-04T15:35:57.000Z" itemprop="datePublished">2022-09-04</time></div></header><div class="article-entry" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>近三周应小学期老师要求，和4位队友合作开发了一个微型数据库系统。由于耗费了许多的精力，我想将开发过程记录在这个博客上。</p><h2 id="功能性需求："><a href="#功能性需求：" class="headerlink" title="功能性需求："></a>功能性需求：</h2><ol><li>创建数据库和表，能够以文件形式保存在磁盘上（操作系统的文 件、进程管理，数据结构 的 B树）</li><li>支持表的增删改查（数据库 中SQL形式，编译的词法语法检查）</li><li>SQL中支持通配符（数据结构的查找）、多表连接（操作系统 的 文件管理）</li><li>支持整数、实数、字符（串）、日期等数据类型</li><li>支持索引（数据库、数据结构 ）</li></ol><h2 id="性能性需求"><a href="#性能性需求" class="headerlink" title="性能性需求"></a>性能性需求</h2><ol><li>单表记录最大行数不少于10万行，不少于10 列</li><li>单表响应时间不多于 1秒（普通笔记本）</li><li>主表不少于5000行，子表不少于20000行时，连接操作响应时 间不多于 2 秒</li></ol><h1 id="痛苦的开端"><a href="#痛苦的开端" class="headerlink" title="痛苦的开端"></a>痛苦的开端</h1><h2 id="最初的迷茫"><a href="#最初的迷茫" class="headerlink" title="最初的迷茫"></a>最初的迷茫</h2><p>开始的时候确实是啥也不知道，一堆人在教室里商量了半天也没想明白该干些什么，就留了两天各自查资料。等大家查完，在教室里一讨论，就发现任务极其重大。由于要实现5000*20000级别的表连接，还有100 000级别的数据插入，因此我们需要考虑底层的文件存储，但由于开发经验的不足和工期较短，我们在讨论中断定，凭空实现完全的页面管理对我们来说是不可能的，因此决定退而求其次，找一份有页面管理的借鉴一下。</p><p>因此，我们翻看了sqlite的源码，还通篇学习了一门斯坦福的课程（代码仓库叫redbase）,在途中，还重新确定了我们要实现的关键字等需求。</p><h2 id="借鉴都借鉴不明白"><a href="#借鉴都借鉴不明白" class="headerlink" title="借鉴都借鉴不明白"></a>借鉴都借鉴不明白</h2><p>然后就出现了问题，我们找到了一份很好的页面管理代码，但光页面管理（包括缓冲区管理）的代码量就直接超过了8000行，为了实现它我们需要做的工作过于繁复（虽然我们确实尝试了一天）。</p><p>同时，Linux开发也对我们组造成了较大的麻烦，因为有开发经验的仅有一人，其他人光环境配置就花了很长时间。后来采用先富带后富的方式，总算是搞定了整组的环境。</p><h2 id="借鉴不了，想一个自己的框架吧！"><a href="#借鉴不了，想一个自己的框架吧！" class="headerlink" title="借鉴不了，想一个自己的框架吧！"></a>借鉴不了，想一个自己的框架吧！</h2><p>最后，我们发现，我们的这种特种需求，只有我们自己琢磨一个框架来才能够满足3周内开发完成，且能够实现一定的文件管理和查询优化。</p><p>这里用文字形容一下我们初步商量的框架</p><blockquote><p>顶层：词法分析-&gt;语法分析，产出一棵抽象语法树</p><p>中层：语义分析，并实现一系列数据库操作函数</p><p>底层：B+树代码和物理存储管理代码，存储二进制数据。</p></blockquote><p>中层咱暂时实在想不明白，就先大致写了一点儿，之后先把顶层和底层开发出来，到时候再看中层该怎么搞。</p><h1 id="辛苦又充满成长的开发过程"><a href="#辛苦又充满成长的开发过程" class="headerlink" title="辛苦又充满成长的开发过程"></a>辛苦又充满成长的开发过程</h1><p>经历了鸡飞狗跳，还有一堆学校其他杂事（搬家，做华为云实验）的一周之后，我们正式开始开发。</p><h2 id="顶层"><a href="#顶层" class="headerlink" title="顶层"></a>顶层</h2><p>顶层被我们归类为最困难的工作，我们想了些取巧的办法让它稍微简单一点儿。这块儿是组里大佬写的，我也只是有所了解。</p><p>参考redbase的顶层（就算是斯坦福的课，顶层代码也是预先写好，不用学生写的），我们按照自己的需求写了一份语法文件，并用yacc（应该）生成分析代码。</p><h2 id="底层"><a href="#底层" class="headerlink" title="底层"></a>底层</h2><p>第二周折腾了老半天，把一份B+树代码折腾出来了，它还满足我们的要求（改泛型改了一个周末）：能够存储int，float和string类型的数据（本来还有个要求是，一级索引将和纯数据文件放在一起，方便存取，但泛型这东西实在不是一个初学c++的同志能整的这么明白的，就没实现）</p><h3 id="数据文件（初版）"><a href="#数据文件（初版）" class="headerlink" title="数据文件（初版）"></a>数据文件（初版）</h3><p>这里给出示例文件框架</p><blockquote><p>save</p><p>-table1 示例表名</p><p>–table1.data存放二进制数据文件</p><p>—-table1.meta存放表说明文件</p><p>—-IND&#x2F;&#x2F;存放索引</p><p>——-table1&#x2F;&#x2F;自增主键索引</p><p>—其他索引</p></blockquote></div><footer class="article-footer"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/database/" rel="tag">database</a></li></ul></footer></div><nav class="article-nav pt-4 mt-3" id="article-nav"><a href="/2022/09/11/2022-09-11-%E8%AE%A1%E7%BB%84%E5%A4%8D%E4%B9%A0/" id="article-nav-newer" class="article-nav-link-wrap"><strong class="article-nav-caption">Newer</strong><div class="article-nav-title">计组复习</div></a><a href="/2022/04/02/2022-04-02-%E5%AD%97%E8%8A%82%E4%BA%8C%E9%9D%A2%E8%AE%B0%E5%BD%95/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">Older</strong><div class="article-nav-title">字节二面记录</div></a></nav></article></div></section><footer class="footer pt-5 mt-5"><div class="container"><div class="py-3"><div class="row justify-content-between"><div class="col-6"><img class="filter-gray mb-3 lazyload" height="40" data-src="/images/brand.svg" alt="Hexo" role="img"><p class="mb-4"></p><ul class="list-inline"></ul></div><div class="col-4"><h5>友情链接</h5><ul class="list-inline"></ul></div></div></div><hr class="hr" style="opacity:.25"><div class="pt-3 pb-5"><ul class="list-inline mb-0 text-center"><li class="list-inline-item">&copy; 2023 Hexo</li><li class="list-inline-item">Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li><li class="list-inline-item">Designer <a href="https://acorn.imaging.xin/" target="_blank">YSH</a></li></ul></div></div></footer></main><div id="mobile-nav-dimmer"></div><div id="mobile-nav"><div id="mobile-nav-inner"><ul class="mobile-nav"><li class="nav-item"><a class="nav-item-link" href="/">首页</a></li><li class="nav-item"><a class="nav-item-link" href="/gallery">画廊</a></li><li class="nav-item"><a class="nav-item-link" href="/stories">案例</a></li><li class="nav-item"><a class="nav-item-link" href="/archives">新闻</a></li><li class="nav-item"><a class="nav-item-link" href="/about">关于</a></li></ul></div></div><script src="/libs/feather/feather.min.js"></script><script src="/libs/lazysizes/lazysizes.min.js"></script><script src="/libs/tocbot/tocbot.min.js"></script><script>tocbot.init({tocSelector:".js-toc",contentSelector:".js-toc-content",headingSelector:"h2, h3",hasInnerContainers:!0})</script><script src="/js/mobile-nav.js"></script><script src="/js/script.js"></script></body></html>