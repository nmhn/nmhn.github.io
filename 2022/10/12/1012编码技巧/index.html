<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><title>编码技巧 笔记 | Hexo</title><link rel="apple-touch-icon" sizes="57x57" href="/images/webclip/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="72x72" href="/images/webclip/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/images/webclip/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/images/webclip/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/images/webclip/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/images/webclip/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/images/webclip/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/webclip/apple-touch-icon-180x180.png"><link rel="apple-touch-icon" sizes="167x167" href="/images/webclip/apple-touch-icon-167x167.png"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml"></head><body><main class="main"><header class="header"><div class="container"><nav class="navbar d-flex align-items-center"><a class="brand" href="/"><img class="logo lazyload" data-src="/images/brand.svg" alt="Hexo" role="img"></a><ul class="main-nav"><li class="nav-item"><a class="nav-item-link" href="/">首页</a></li><li class="nav-item"><a class="nav-item-link" href="/gallery">画廊</a></li><li class="nav-item"><a class="nav-item-link" href="/stories">案例</a></li><li class="nav-item"><a class="nav-item-link" href="/archives">文章</a></li><li class="nav-item"><a class="nav-item-link" href="/about">关于</a></li></ul></nav><a id="mobile-nav-toggle"><span class="mobile-nav-toggle-bar"></span> <span class="mobile-nav-toggle-bar"></span> <span class="mobile-nav-toggle-bar"></span></a></div></header><section><div class="container"><article id="post-1012编码技巧" class="article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting"><div class="artcle-cover mb-5"></div><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">编码技巧 笔记</h1><div class="article-meta"><time class="text-gray" datetime="2022-10-12T01:43:00.000Z" itemprop="datePublished">2022-10-12</time><div class="article-category"><a class="article-category-link" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></div></div></header><div class="article-entry" itemprop="articleBody"><h2 id="1-整洁性"><a href="#1-整洁性" class="headerlink" title="1 整洁性"></a>1 整洁性</h2><ul><li>语义简单明确,优先考虑易于读者理解的写法</li><li>简洁!&#x3D;代码短<ul><li>复杂的问号表达式反而不如 if else 方便理解<ul><li>个人疑问:问号表达式可以一定程度上提供条件数据传送,而非条件转移</li></ul></li></ul></li><li>提前返错<ul><li>提前返回错误判断可以减少主体逻辑的缩进数量,使主体代码逻辑更醒目</li></ul></li><li>利用析构函数做清理工作<ul><li>利用C++析构函数做清理工作,在复杂冗长代码中不会漏掉. 比如执行回调,关闭文件,释放内存</li></ul></li><li>用朴素直观的算法<ul><li>在非关键路径上,优先使用朴素直观,维护性好的代码.</li></ul></li><li>用轮询代替条件变量<ul><li>非关键路径上这么做,代码间接,不容易出bug</li><li>轮询: 一直等待信号</li></ul></li><li>在关键对象增加magic字段<ul><li>增加magic字段和断言检查,可以及时发现内存错误</li></ul></li></ul><h2 id="2-测试"><a href="#2-测试" class="headerlink" title="2 测试"></a>2 测试</h2><ul><li><p>边界</p></li><li><p>状态&#x2F;分支测试</p></li><li><p>重复&#x2F;幂等性测试</p></li><li><p>兼容性测试</p></li><li><p>防御性测试</p><ul><li>关注系统在最差情况下的表现,明确能力边界</li></ul></li><li><p>避免写出不稳定case</p><ul><li><p>例</p></li><li><blockquote><ul><li>测试不聚焦，无脑复制粘贴，等价类测试爆炸</li><li>异步等待，基于时间假设，sleep 并发，未能在预期的窗口期交互</li><li>有顺序依赖的测试，共享某个状态</li><li>资源溢出，数据库链接满、内存 OOM 析构随机 core</li><li>析构未严格保序或者未构造</li><li>多线程共享资源的错误用法导致概率 crash</li><li>有未处理完的任务就退出</li></ul></blockquote></li></ul></li></ul><h2 id="3-提交"><a href="#3-提交" class="headerlink" title="3 提交"></a>3 提交</h2><ol><li>一次提交不要超过400行代码,最好只解决一个问题</li><li>自我检查<ol><li>速度&lt;500行&#x2F;小时</li><li>一次review时间不超过1小时</li><li>接口&gt;测试&gt;实现</li></ol></li></ol><h2 id="4-高效工作方法"><a href="#4-高效工作方法" class="headerlink" title="4 高效工作方法"></a>4 高效工作方法</h2><ul><li><p>抽象和分而治之</p><ul><li>抽象:明确模块之间的依赖关系,确定API接口</li><li>分而治之:对子系统设计进行合理的注释,帮助理解</li><li>代码提交尽量做到原子[不可分割的特性.修复.优化],测试代码一同提交</li></ul></li><li><p>不要重复</p><ul><li>寻找重复逻辑和代码,并进行封装</li><li>寻找流程重复,使用脚本或者工具自动化</li><li>沉淀踩坑经验</li></ul></li><li><p>快速迭代</p><ul><li>不要过度设计</li><li>尽快让代码运行和快速验证,不断迭代来完善</li><li>为了快速验证,本地测试成本低</li><li>实现一个可运行的脚手架,再持续添加内容</li></ul></li><li><p>忌“太心急”，慢即是快</p></li><li><ul><li>需求澄清：类似 TCP 三次握手，用自己理解的方式再给对方讲一遍，确认双方理解一致，对焦，避免重复返工</li><li>自我提问：为什么做这件事？业务价值是什么？关键技术是什么？已有的系统和它对比有什么不同？兄弟团队是否做过类似的工作？是否有经验可供参考？业务&#x2F;技术的适用场景是什么？预计耗时和进度风险？</li><li>新人往往脚踏实地，忘记了仰望星空，只顾着埋头苦干，不思考背后的业务价值，这一锄头，那一铁锹，遍地都是坑，就是不开花，费时费力，成就感低。</li></ul></li><li><p>忌低效沟通，用数据说话</p></li><li><ul><li>精确地描述问题，上下文和范围，提供有效信息</li><li>文档是提高沟通效率的最佳方式之一，Google 有文档文化，推荐阅读《Design Docs at Google》﻿[5]</li><li>Bad Case：「测试 CX6 网卡时，IOPS 大幅下降」</li><li>Good Case：「在 100g 网络标卡 CX6 验证性能时，8 jobs 32 depth iosize 4K 场景下，极限 IOPS 从 120 万下降至 110 万，与 FIC 卡相比性能存在 8% 差异」</li></ul></li><li><p>忌“蠢问题”，学会提问</p></li><li><ul><li>鼓励新人多提问，但提问的问题一定要有质量</li><li>关于如何提出一个好问题推荐阅读《提问的智慧》﻿[6]</li><li>Bad Case：「我在编译耗时很长，我怀疑是资源不够，这种情况怎么办？」</li><li>Good Case：「我的开发机编译耗时 2 小时，不符合预期，OS 是 centOS 7U、128GB 内存、64Core，编译并发度是 20 核，未限制内存，编译过程使用 Top 查看确实 20 核并发，Cpu 和 Mem没有达到瓶颈，iostat 看磁盘使用率每秒 60%」</li></ul></li><li></li><li><h2 id="5-延伸阅读"><a href="#5-延伸阅读" class="headerlink" title="5 延伸阅读"></a>5 延伸阅读</h2></li><li><blockquote><p>编写可读代码的艺术</p><p>software Engineer at Google</p><p>人月神话</p><p>数据密集型应用系统设计</p></blockquote></li><li></li></ul></div><footer class="article-footer"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%8A%80%E5%B7%A7/" rel="tag">技巧</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a></li></ul></footer></div><nav class="article-nav pt-4 mt-3" id="article-nav"><a href="/2022/10/13/1013%20%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/" id="article-nav-newer" class="article-nav-link-wrap"><strong class="article-nav-caption">Newer</strong><div class="article-nav-title">csapp 异常控制流</div></a><a href="/2022/10/12/1012%20Linking/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">Older</strong><div class="article-nav-title">CSAPP Linking 笔记</div></a></nav></article></div></section><footer class="footer pt-5 mt-5"><div class="container"><div class="py-3"><div class="row justify-content-between"><div class="col-6"><img class="filter-gray mb-3 lazyload" height="40" data-src="/images/brand.svg" alt="Hexo" role="img"><p class="mb-4"></p><ul class="list-inline"></ul></div><div class="col-4"><h5>友情链接</h5><ul class="list-inline"></ul></div></div></div><hr class="hr" style="opacity:.25"><div class="pt-3 pb-5"><ul class="list-inline mb-0 text-center"><li class="list-inline-item">&copy; 2023 Hexo</li><li class="list-inline-item">Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li><li class="list-inline-item">Designer <a href="https://acorn.imaging.xin/" target="_blank">YSH</a></li></ul></div></div></footer></main><div id="mobile-nav-dimmer"></div><div id="mobile-nav"><div id="mobile-nav-inner"><ul class="mobile-nav"><li class="nav-item"><a class="nav-item-link" href="/">首页</a></li><li class="nav-item"><a class="nav-item-link" href="/gallery">画廊</a></li><li class="nav-item"><a class="nav-item-link" href="/stories">案例</a></li><li class="nav-item"><a class="nav-item-link" href="/archives">文章</a></li><li class="nav-item"><a class="nav-item-link" href="/about">关于</a></li></ul></div></div><script src="/libs/feather/feather.min.js"></script><script src="/libs/lazysizes/lazysizes.min.js"></script><script src="/libs/tocbot/tocbot.min.js"></script><script>tocbot.init({tocSelector:".js-toc",contentSelector:".js-toc-content",headingSelector:"h2, h3",hasInnerContainers:!0})</script><script src="/js/mobile-nav.js"></script><script src="/js/script.js"></script></body></html>