<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>csapp 异常控制流 | Hexo</title><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>var config={root:"/",path:"search.json"}</script><script src="//unpkg.com/mermaid@8.13.5/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:!0,theme:"dark"})</script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@11.4.0/styles/atom-one-dark-reasonable.min.css"><style>@font-face{font-family:BenderLight;src:local('Bender'),url(/font/BenderLight.ttf)}@font-face{font-family:'JetBrains Mono';src:local('JetBrains Mono'),url(/font/JetBrainsMono-Regular.woff2) format('woff2')}</style><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml"></head><body style="background-image:url(https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg)"><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><ol class="navContent"><li class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></li><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav><div class="search-popup"><div id="search-result"></div></div></header><article><div id="post-bg"><div id="post-title"><h1>csapp 异常控制流</h1><div id="post-info"><span>First Post:<div class="control"><time datetime="2022-10-13T02:43:00.000Z" id="date">2022-10-13</time></div></span><br><span>Last Update:<div class="control"><time datetime="2022-10-13T08:08:23.976Z" id="updated">2022-10-13</time></div></span><br><span>Word Count:<div class="control">695</div></span><br><span>Read Time:<div class="control">2 min</div></span></div></div><hr><div id="post-content"><h1 id="1013-异常控制流"><a href="#1013-异常控制流" class="headerlink" title="1013 异常控制流"></a>1013 异常控制流</h1><h3 id="Exception-Control-Flow-ECF"><a href="#Exception-Control-Flow-ECF" class="headerlink" title="Exception Control Flow ECF"></a>Exception Control Flow ECF</h3><h2 id="1-1-异常处理"><a href="#1-1-异常处理" class="headerlink" title="1.1 异常处理"></a>1.1 异常处理</h2><blockquote><p>启动时生成<strong>异常表</strong></p><p>运行时检测到异常,确定异常号,查找异常表,进入处理程序</p><p>执行完后,执行一条”从中断返回”指令,将控制返回给被中断的程序[如果是一个用户程序被中断]</p></blockquote><h2 id="1-2异常类别"><a href="#1-2异常类别" class="headerlink" title="1.2异常类别"></a>1.2异常类别</h2><ol><li><p>中断</p></li><li><p>陷阱和系统调用</p><blockquote><p>陷阱: 有意的异常,用来在用户程序和内核之间提供一个像过程一样的接口–系统调用</p></blockquote></li><li><p>故障</p><blockquote><p>如 除法错误,却也,一般保护故障[程序引用了一个未定义的虚拟内存区域,Linux一般会报告为一个 段故障 Segmentation fault]</p></blockquote></li><li><p>终止</p><blockquote><p>不可恢复的致命错误–通常硬件错误</p></blockquote></li></ol><h2 id="2-进程"><a href="#2-进程" class="headerlink" title="2 进程"></a>2 进程</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><blockquote><p>一个执行中程序的实例</p></blockquote><p>维护一个 该程序是系统中当前运行的唯一程序的假象</p><p>拥有</p><ul><li>一个独立的逻辑控制流<ul><li>提供独占处理器的假象</li></ul></li><li>一个私有的地址空间<ul><li>提供独占内存系统的假象</li></ul></li></ul><h3 id="进程空间"><a href="#进程空间" class="headerlink" title="进程空间"></a>进程空间</h3><p>给出通用结构</p><blockquote><p>以x86-64 Linux为例</p><img src="assets/image-20221013142209341.png" alt="image-20221013142209341" style="zoom:50%"></blockquote><h3 id="上下文切换"><a href="#上下文切换" class="headerlink" title="上下文切换"></a>上下文切换</h3><p>用于实现多任务</p><p>上下文: 重新启动一个被抢占的进程所需的状态</p><h2 id="系统调用错误处理"><a href="#系统调用错误处理" class="headerlink" title="系统调用错误处理"></a>系统调用错误处理</h2><p>Unix系统级函数遇到错误时,通常会返回-1,并设置全局整数变量errno来表示什么出错了.</p><h2 id="进程控制"><a href="#进程控制" class="headerlink" title="进程控制"></a>进程控制</h2><p>重点是创建子进程</p><p>父进程调用fork函数创建一个子进程</p><h3 id="父子进程区别"><a href="#父子进程区别" class="headerlink" title="父子进程区别"></a>父子进程区别</h3><blockquote><p>相同</p><ul><li>虚拟地址空间<ul><li>代码</li><li>数据段</li><li>堆</li><li>共享库</li><li>用户栈</li></ul></li><li>打开描述符<ul><li>意味着父进程调用fork时,子进程可以读写父进程中打开的任何文件</li></ul></li></ul><p>区别</p><ul><li>Pid<ul><li>进程id不同</li></ul></li><li>并发执行<ul><li>父进程和子进程是并发运行的独立进程</li></ul></li><li>虚拟地址空间<ul><li><strong>子进程得到的副本和父进程相同,包括打开的文件描述符,但是是一份独立的副本,也就是说,之后的调用,子进程和父进程独立.</strong></li></ul></li></ul></blockquote><p>fork</p><ul><li>调用一次返回两次<ul><li>一次是在调用进程(父进程中)<ul><li>返回子进程PID(非零)</li></ul></li><li>一次在创建的进程中(子进程中)<ul><li>返回0</li></ul></li></ul></li><li>可以用来辨认子进程还是父进程</li></ul><h3 id="回收子进程"><a href="#回收子进程" class="headerlink" title="回收子进程"></a>回收子进程</h3><p>步骤: 终止-&gt;分配给init进程作为养父-&gt;父进程回收[若父进程没来得及回收,则由init进程回收]</p><h2 id="信号"><a href="#信号" class="headerlink" title="信号"></a>信号</h2><p>较高层</p><ul><li>是一个小消息,通知进程系统中发生了一个某种类型的事件.</li><li>用于通知用户进程发生了一些低层的硬件异常</li></ul><div id="paginator"></div></div><div id="post-footer"><div id="pages"><div id="footer-link" style="right:calc(50% - 1px);order:1;border-right:1px solid #fe2;padding-left:unset;max-width:calc(50% - 4px)"><a href="/2022/10/13/1013%E7%BC%96%E5%86%99%E5%8F%AF%E8%AF%BB%E4%BB%A3%E7%A0%81%E7%9A%84%E8%89%BA%E6%9C%AF%20%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/">← Next 编码技巧 笔记</a></div><div id="footer-link" style="left:50%;order:0;border-left:1px solid #fe2;padding-right:unset;max-width:calc(50% - 5px)"><a href="/2022/10/12/1012%E7%BC%96%E7%A0%81%E6%8A%80%E5%B7%A7/">编码技巧 笔记 Prev →</a></div></div></div><div id="Valine"></div></div><div id="bottom-btn"><a id="to-index" href="#toc-div" title="index">≡</a><a id="to-top" onclick="scrolls.scrolltop()" title="to top" style="opacity:0;display:none">∧</a></div></article><aside><div id="aside-top"><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a target="_blank" rel="noopener" href="https://github.com/Yue-plus">YSH</a></h1><div id="description"></div></div><div id="aside-block"><div id="toc-div"><h1>INDEX</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1013-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81"><span class="toc-number">1.</span> <span class="toc-text">1013 异常控制流</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Exception-Control-Flow-ECF"><span class="toc-number">1.0.1.</span> <span class="toc-text">Exception Control Flow ECF</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 异常处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2%E5%BC%82%E5%B8%B8%E7%B1%BB%E5%88%AB"><span class="toc-number">1.2.</span> <span class="toc-text">1.2异常类别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.3.</span> <span class="toc-text">2 进程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89"><span class="toc-number">1.3.1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E7%A9%BA%E9%97%B4"><span class="toc-number">1.3.2.</span> <span class="toc-text">进程空间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2"><span class="toc-number">1.3.3.</span> <span class="toc-text">上下文切换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">1.4.</span> <span class="toc-text">系统调用错误处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6"><span class="toc-number">1.5.</span> <span class="toc-text">进程控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%B6%E5%AD%90%E8%BF%9B%E7%A8%8B%E5%8C%BA%E5%88%AB"><span class="toc-number">1.5.1.</span> <span class="toc-text">父子进程区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9E%E6%94%B6%E5%AD%90%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.5.2.</span> <span class="toc-text">回收子进程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E5%8F%B7"><span class="toc-number">1.6.</span> <span class="toc-text">信号</span></a></li></ol></div></div></div><footer><nobr><span class="text-title">ICP</span><a class="text-content" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">赣ICP备19008355号</a></nobr><nobr><span class="text-title">©</span><span class="text-content">1970 to 2020</span></nobr><br><nobr>published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr>Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknight</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><div id="cursor-container"><div id="cursor-outer"></div><div id="cursor-effect"></div></div><script src="/js/search.js"></script><script class="pjax-js">reset=e=>{new Valine({el:"#Valine",appId:"MkE8c5Abvy4XAwiLVVgu2cbC-gzGzoHsz",appKey:"IYs46cd4ti4DN1JUw7aNIRVj",placeholder:"此条评论委托企鹅物流发送"}),code.findCode(),mermaid.init(void 0,".mermaid")}</script><script src="//unpkg.com/@highlightjs/cdn-assets@11.4.0/highlight.min.js"></script><script src="/js/arknights.js"></script><script>window.addEventListener("load",()=>{reset()})</script></body></html>