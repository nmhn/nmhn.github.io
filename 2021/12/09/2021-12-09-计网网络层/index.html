<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>网络层 | Hexo</title><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>var config={root:"/",path:""}</script><script src="//unpkg.com/mermaid@8.13.5/dist/mermaid.min.js"></script><script>mermaid.initialize({startOnLoad:!0,theme:"dark"})</script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@11.4.0/styles/atom-one-dark-reasonable.min.css"><style>@font-face{font-family:BenderLight;src:local('Bender'),url(/font/BenderLight.ttf)}@font-face{font-family:'JetBrains Mono';src:local('JetBrains Mono'),url(/font/JetBrainsMono-Regular.woff2) format('woff2')}</style><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml"></head><body style="background-image:url(https://ak.hypergryph.com/assets/index/images/ak/pc/bk.jpg)"><main><header class="closed"><nav><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><ol class="navContent"><li class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></li><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/demo/"><span class="navItemTitle">独立页面</span></a></li></ol></nav><div class="search-popup"><div id="search-result"></div></div></header><article><div id="post-bg"><div id="post-title"><h1>网络层</h1><div id="post-info"><span>First Post:<div class="control"><time datetime="2021-12-09T02:48:15.000Z" id="date">2021-12-09</time></div></span><br><span>Last Update:<div class="control"><time datetime="2022-10-12T04:37:28.040Z" id="updated">2022-10-12</time></div></span><br><span>Word Count:<div class="control">957</div></span><br><span>Read Time:<div class="control">3 min</div></span></div></div><hr><div id="post-content"><h1 id="网络层-控制平面"><a href="#网络层-控制平面" class="headerlink" title="网络层-控制平面"></a>网络层-控制平面</h1><h2 id="路由算法"><a href="#路由算法" class="headerlink" title="路由算法"></a>路由算法</h2><h6 id="产生路由表的算法"><a href="#产生路由表的算法" class="headerlink" title="产生路由表的算法"></a>产生路由表的算法</h6><h3 id="图论抽象"><a href="#图论抽象" class="headerlink" title="图论抽象"></a>图论抽象</h3><p>Graph: G &#x3D; <strong>(N,E)</strong></p><p><strong>N</strong> &#x3D; set of routers &#x3D; { u, v, w, x, y, z } 节点是<strong>路由器</strong></p><p><strong>E</strong> &#x3D; set of links &#x3D;{ (u,v), (u,x), (v,x), (v,w), (x,w), (x,y), (w,y), (w,z), (y,z) } 边是<strong>物理链路</strong></p><p>链路开销Cost of link：时延、费用或拥塞等级 路径开销Cost of path：c(x1 , x2 , x3 ,…, xp ) &#x3D; c(x1 ,x2 ) + c(x2 ,x3 ) + … + c(xp-1 ,xp )</p><p><strong>路由算法</strong>：找到开销最小的路径(路由器序列)</p><p><strong>分散式</strong>算法–只知道和部分路径,通过和邻居交换信息</p><p>典型就是下面这个算法</p><h3 id="•-距离向量路由算法"><a href="#•-距离向量路由算法" class="headerlink" title="• 距离向量路由算法"></a>• 距离向量路由算法</h3><h4 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h4><ol><li><p>节点x维护距离向量</p><p>Dx&#x3D;[dx (y): yєN ]<br>(如果y不是x的邻居节点, 则dx (y)&#x3D;∞,否则dx (y)&#x3D; c(x,y))</p></li><li><p>每个节点周期性向其邻居节点发送它自己的 距离向量, 节点x保存其邻居节点的距离向量<br>Dv &#x3D; [dv (y): y є N ]</p></li><li><p>n当节点x接收到来自邻居的 新距离向量，它使用B-F方程更新自己的DV :<br>Dx (y) ← minv {c(x,v) + Dv (y)} for each node y ∊ N<br>Bellman-Ford方程：</p><ol><li>定义<br>$d_x$ (y) &#x3D; 从x到y的最小开销路径的开销,c(x,v) &#x3D; 从x到邻居节点v的链路的开销</li><li>则dx (y) &#x3D; minv {c(x,v) + dv (y) }</li><li>取值最小的节点对应最短路径中的<strong>下一跳</strong>(只有一个地址)➜ 转发表</li></ol><p>示例<code>&lt;img src=&quot;https://s2.loli.net/2021/12/09/HhICGUakqft2zm1.png&quot; alt=&quot;image-20211122134953146&quot; style=&quot;zoom:50%;&quot; /&gt;</code></p></li></ol><h3 id="•-链路状态路由算法-•"><a href="#•-链路状态路由算法-•" class="headerlink" title="• 链路状态路由算法 •"></a>• 链路状态路由算法 •</h3><ol><li>Discover its neighbors, learn their network address. <strong>发现邻居，学习它们的网络地址</strong></li><li>Measure the delay or cost to each of its neighbors. <strong>测量到每一个邻居的时延或开销</strong></li><li>Construct a packet (link state packet)telling all it has just learned. <strong>构造一个分组(链路状态分组) 来通 告其学习到的所有信息</strong></li><li>Send this packet to all other routers. <strong>向所有路由器发送该分组</strong></li><li>Compute the shortest path to every other router. <strong>计算到其他路由器的最短路径</strong><br>使用Dijkstra算法计算最短路径<br><code>&lt;img src=&quot;https://s2.loli.net/2021/12/09/mCdF4G2wO7vxpUW.png&quot; alt=&quot;image-20211122143134224&quot; style=&quot;zoom:50%;&quot; /&gt;</code></li></ol><h2 id="路由协议"><a href="#路由协议" class="headerlink" title="路由协议"></a>路由协议</h2><p>受到分组压力,单位需求的影响,产生了as(自治系统)</p><p>系统内可以用之前的算法,系统外–?自治系统间专门的路由协议</p><h3 id="•-O-pen-S-hortest-P-ath-F-irst-路由协议"><a href="#•-O-pen-S-hortest-P-ath-F-irst-路由协议" class="headerlink" title="• O(pen)S(hortest)P(ath)F(irst)路由协议"></a>• O(pen)S(hortest)P(ath)F(irst)路由协议</h3><h5 id="自治系统内路由-开放最短路径优先"><a href="#自治系统内路由-开放最短路径优先" class="headerlink" title="自治系统内路由-开放最短路径优先"></a>自治系统内路由-开放最短路径优先</h5><h6 id="使用的算法是链路状态算法"><a href="#使用的算法是链路状态算法" class="headerlink" title="使用的算法是链路状态算法"></a>使用的算法是<strong>链路状态算法</strong></h6><p>OSPF的特点</p><ol><li>安全性–报文经过签名鉴别</li><li>使用多条开销相同的路径</li><li>对每条链路,为不同的服务类型设置多种开销度量</li><li>集成的单播和多播支持</li></ol><h5 id="层次ospf"><a href="#层次ospf" class="headerlink" title="层次ospf"></a>层次ospf</h5><p>自治系统内进一步再分</p><h3 id="•-BGP路由协议-border-gateway-protocol"><a href="#•-BGP路由协议-border-gateway-protocol" class="headerlink" title="• BGP路由协议(border gateway protocol)"></a>• BGP路由协议(border gateway protocol)</h3><h5 id="自治系统间路由"><a href="#自治系统间路由" class="headerlink" title="-自治系统间路由"></a>-自治系统间路由</h5><p>算法-距离向量算法(改名—路径向量算法)</p><ol><li>eBGP: Obtain subnet reachability information from</li></ol><p>neighboring ASes.从相邻AS获得子网可达性信息</p><ol start="2"><li>iBGP: Propagate reachability information to all AS-internal</li></ol><p>routers. 向AS内部的所有路由器传播可达性信息</p><ol start="3"><li>Determine “good” routes to subnets based on reachability</li></ol><p>information and policy.根据可达性信息和策略，决定到子网</p><p>的“好”路由</p><h2 id="•ICMP-The-Internet-Control"><a href="#•ICMP-The-Internet-Control" class="headerlink" title="•ICMP-The Internet Control"></a>•ICMP-The Internet Control</h2><p>差错报告–不可达网络\主机\端口\协议</p><p>回声请求</p><p>trace route</p><p>源主机从ttl&#x3D;1,一点点开始发送更大的ttl,目的端口号设置为一个不可能到达的端口,</p><p>当ttl超时时,该路由器发送一个ICMP报文到源主机,这样会获取路径上路由器的信息</p><p>到达目的主机后,会返回一个端口不可达报文,探测结束</p><h2 id="Message-Protocol"><a href="#Message-Protocol" class="headerlink" title="Message Protocol"></a>Message Protocol</h2><h2 id="•网络管理——SNMP协议"><a href="#•网络管理——SNMP协议" class="headerlink" title="•网络管理——SNMP协议"></a>•网络管理——SNMP协议</h2><div id="paginator"></div></div><div id="post-footer"><div id="pages"><div id="footer-link" style="right:calc(50% - 1px);order:1;border-right:1px solid #fe2;padding-left:unset;max-width:calc(50% - 4px)"><a href="/2021/12/09/2021-12-09-%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2/">← Next 网络地址转换</a></div><div id="footer-link" style="left:50%;order:0;border-left:1px solid #fe2;padding-right:unset;max-width:calc(50% - 5px)"><a href="/2021/12/09/2021-12-09-%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/">计网笔记-数据链路层 Prev →</a></div></div></div><details id="reward"><summary>打赏</summary><div id="alipay"><span>支付宝 | Alipay</span><br><img src="/img/Alipay.png"></div><div id="wechat"><span>微信 | WeChat</span><br><img src="/img/WeChat.png"></div></details><div id="Valine"></div></div><div id="bottom-btn"><a id="to-index" href="#toc-div" title="index">≡</a><a id="to-top" onclick="scrolls.scrolltop()" title="to top" style="opacity:0;display:none">∧</a></div></article><aside><div id="aside-top"><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a target="_blank" rel="noopener" href="https://github.com/Yue-plus">YSH</a></h1><div id="description"></div></div><div id="aside-block"><div id="toc-div"><h1>INDEX</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82-%E6%8E%A7%E5%88%B6%E5%B9%B3%E9%9D%A2"><span class="toc-number">1.</span> <span class="toc-text">网络层-控制平面</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95"><span class="toc-number">1.1.</span> <span class="toc-text">路由算法</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BA%A7%E7%94%9F%E8%B7%AF%E7%94%B1%E8%A1%A8%E7%9A%84%E7%AE%97%E6%B3%95"><span class="toc-number">1.1.0.0.0.1.</span> <span class="toc-text">产生路由表的算法</span></a></li></ol></li></ol></li></ol><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E8%AE%BA%E6%8A%BD%E8%B1%A1"><span class="toc-number">1.1.1.</span> <span class="toc-text">图论抽象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%A2-%E8%B7%9D%E7%A6%BB%E5%90%91%E9%87%8F%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95"><span class="toc-number">1.1.2.</span> <span class="toc-text">• 距离向量路由算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">描述</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%A2-%E9%93%BE%E8%B7%AF%E7%8A%B6%E6%80%81%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95-%E2%80%A2"><span class="toc-number">1.1.3.</span> <span class="toc-text">• 链路状态路由算法 •</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.2.</span> <span class="toc-text">路由协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%A2-O-pen-S-hortest-P-ath-F-irst-%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.2.1.</span> <span class="toc-text">• O(pen)S(hortest)P(ath)F(irst)路由协议</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E6%B2%BB%E7%B3%BB%E7%BB%9F%E5%86%85%E8%B7%AF%E7%94%B1-%E5%BC%80%E6%94%BE%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E4%BC%98%E5%85%88"><span class="toc-number">1.2.1.0.1.</span> <span class="toc-text">自治系统内路由-开放最短路径优先</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%9A%84%E7%AE%97%E6%B3%95%E6%98%AF%E9%93%BE%E8%B7%AF%E7%8A%B6%E6%80%81%E7%AE%97%E6%B3%95"><span class="toc-number">1.2.1.0.1.1.</span> <span class="toc-text">使用的算法是链路状态算法</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B1%82%E6%AC%A1ospf"><span class="toc-number">1.2.1.0.2.</span> <span class="toc-text">层次ospf</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%A2-BGP%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE-border-gateway-protocol"><span class="toc-number">1.2.2.</span> <span class="toc-text">• BGP路由协议(border gateway protocol)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E6%B2%BB%E7%B3%BB%E7%BB%9F%E9%97%B4%E8%B7%AF%E7%94%B1"><span class="toc-number">1.2.2.0.1.</span> <span class="toc-text">-自治系统间路由</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%80%A2ICMP-The-Internet-Control"><span class="toc-number">1.3.</span> <span class="toc-text">•ICMP-The Internet Control</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Message-Protocol"><span class="toc-number">1.4.</span> <span class="toc-text">Message Protocol</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%80%A2%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E2%80%94%E2%80%94SNMP%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.5.</span> <span class="toc-text">•网络管理——SNMP协议</span></a></li></div></div></div><footer><nobr><span class="text-title">ICP</span><a class="text-content" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">赣ICP备19008355号</a></nobr><nobr><span class="text-title">©</span><span class="text-content">1970 to 2020</span></nobr><br><nobr>published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr>Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknight</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><div id="cursor-container"><div id="cursor-outer"></div><div id="cursor-effect"></div></div><script src="/js/search.js"></script><script class="pjax-js">reset=e=>{new Valine({el:"#Valine",appId:"MkE8c5Abvy4XAwiLVVgu2cbC-gzGzoHsz",appKey:"IYs46cd4ti4DN1JUw7aNIRVj",placeholder:"此条评论委托企鹅物流发送"}),code.findCode(),mermaid.init(void 0,".mermaid")}</script><script src="//unpkg.com/@highlightjs/cdn-assets@11.4.0/highlight.min.js"></script><script src="/js/arknights.js"></script><script>window.addEventListener("load",()=>{reset()})</script></body></html>